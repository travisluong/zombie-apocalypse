<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="Node.js MUD">
  <meta name="keywords" content="Node.js MUD">
  <title>Node.js MUD</title>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div id="container">
    <div id="left">
      <div id="chatters">
      </div>
    </div>
    <div id="right">
      <div id="chat_window">
      </div>
      <form action="" id="chat_form">
        <input type="text" name="chat_input" id="chat_input" autocomplete="off"></input>
      </form>
    </div>
  </div>
</body>
<script>
var socket = io.connect('/', {'sync disconnect on unload' : true});

var insertMessage = function (data) {
  $('#chat_window').append('<div>' + data + '</div>');
  $('#chat_window').scrollTop($('#chat_window')[0].scrollHeight);
}

var insertChatter = function (data) {
  $('#chatters').append('<div id="' + data.socket_id + '">' + data.nickname + '</div>');
}

var removeChatter = function (data) {
  $('#chatters div').filter(function () {
    return $(this).text() === data;
  }).remove();
}

var updateChatter = function (data) {
  $('#chatters ' + "#" + data.socket_id).html('<div>' + data.nickname + '</div><div><span class="hp">' + data.hp + 'hp</span> <span class="mp">' + data.mp + "mp</span>");
}

socket.on('connect', function(data) {
  insertMessage("Server connected...");
  var nickname = prompt("What is your nickname?");
  socket.emit('join', nickname);
});

socket.on('messages', function(data) {
  insertMessage(data);
})

socket.on('add chatter', insertChatter);

socket.on('remove chatter', removeChatter);

socket.on('update chatter', updateChatter);

$('#chat_form').submit(function(e) {
  e.preventDefault();
  var message = $('#chat_input').val();
  socket.emit('messages', message);
  $('#chat_input').val("");
});
</script>
</html>
