<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="Node.js MUD">
  <meta name="keywords" content="Node.js MUD">
  <title>Node.js MUD</title>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <link href='http://fonts.googleapis.com/css?family=Butcherman' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div id="header">
    <h1><span>Zombie</span> Apocalypse</h1>
  </div>
  <div id="container">
    <div id="left">
      <div id="chatters">
      </div>
    </div>
    <div id="middle">
      <div id="chat_window">
      </div>
      <form action="" id="chat_form">
        <input type="text" name="chat_input" id="chat_input" autocomplete="off"></input>
      </form>
    </div>
    <div id="right">
      <div id="zombies">
      </div>
    </div>
  </div>
</body>
<script>
var socket = io.connect('/', {'sync disconnect on unload' : true});

var insertMessage = function (data) {
  $('#chat_window').append('<div>' + data + '</div>');
  $('#chat_window').scrollTop($('#chat_window')[0].scrollHeight);
}

var insertChatter = function (data) {
  $('#chatters').append('<div id="' + data.socket_id + '">' + data.nickname + '</div>');
}

var removeChatter = function (data) {
  $('#chatters ' + '#' + data).remove();
}

var updateChatter = function (data) {
  var hp_class, mp_class;
  if (data.alive) {
    hp_class = "hp";
    mp_class = "mp";
  } else {
    hp_class = "dead";
    mp_class = "dead";
  }

  $('#chatters ' + "#" + data.socket_id).html('<div>' +
    data.nickname + '</div><div><span class="' + hp_class +'">' +
    data.hp + 'hp</span> <span class="' + mp_class + '">' +
    data.mp + "mp</span>");
}

var updateZombies = function (data) {
  $('#zombies').empty();

  // data is a hash of zombies
  for (zombie_object in data) {
    zombie = data[zombie_object];
    $('#zombies').append('<div id="' + zombie.id + '">' +
      '<div>zombie ' + zombie.id + '</div><span class="hp">' +
      zombie.hp  + 'hp</span></div>');
  }
}

socket.on('connect', function(data) {
  insertMessage("Server connected...");
  $('#chatters').empty();
  var nickname = prompt("What is your nickname?");
  socket.emit('join', nickname);
});

socket.on('messages', function(data) {
  insertMessage(data);
})

socket.on('add chatter', insertChatter);

socket.on('remove chatter', removeChatter);

socket.on('update chatter', updateChatter);

socket.on('update zombies', updateZombies);

$('#chat_form').submit(function(e) {
  e.preventDefault();
  var message = $('#chat_input').val();
  socket.emit('messages', message);
  $('#chat_input').select();
});
</script>
</html>
